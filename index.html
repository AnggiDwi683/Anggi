<!DOCTYPE html>
<html>
<head>
  <title>Enkripsi RSA & QR Code Generator</title>
  <script src="https://cdn.jsdelivr.net/npm/jsencrypt/bin/jsencrypt.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; max-width: 600px; }
    input, textarea, button { margin: 5px 0; width: 100%; padding: 10px; font-size: 16px; }
    #qrcode { margin-top: 20px; }
  </style>
</head>
<body>

  <h2>RSA Enkripsi ID Surat & QR Code</h2>

  <label for="idSurat">ID Surat:</label>
  <input type="text" id="idSurat" placeholder="Misal: SERTIFIKAT/012/24052025/IGUSTIAYUSRI_BIDANGPENGMAS">

  <label for="p">Bilangan Prima p:</label>
  <input type="number" id="p" placeholder="Contoh: 61">

  <label for="q">Bilangan Prima q:</label>
  <input type="number" id="q" placeholder="Contoh: 53">

  <label for="e">Eksponen Publik e:</label>
  <input type="number" id="e" placeholder="Contoh: 17">

  <button onclick="encryptRSA()">Enkripsi & Generate QR Code</button>

  <label for="cipher">Ciphertext:</label>
  <textarea id="cipher" rows="4" readonly></textarea>

  <div id="qrcode"></div>

  <script>
    function gcd(a, b) {
      while (b !== 0) {
        let t = b;
        b = a % b;
        a = t;
      }
      return a;
    }

    function modInverse(e, phi) {
      let m0 = phi, t, q;
      let x0 = 0, x1 = 1;
      if (phi == 1) return 0;
      while (e > 1) {
        q = Math.floor(e / phi);
        t = phi;
        phi = e % phi;
        e = t;
        t = x0;
        x0 = x1 - q * x0;
        x1 = t;
      }
      if (x1 < 0) x1 += m0;
      return x1;
    }

    function encryptRSA() {
      let idSurat = document.getElementById("idSurat").value;
      let p = parseInt(document.getElementById("p").value);
      let q = parseInt(document.getElementById("q").value);
      let e = parseInt(document.getElementById("e").value);

      if (!idSurat || !p || !q || !e) {
        alert("Mohon isi semua field.");
        return;
      }

      let n = p * q;
      let phi = (p - 1) * (q - 1);

      if (gcd(e, phi) !== 1) {
        alert("e harus coprime dengan Ï†(n).");
        return;
      }

      // Ubah plainteks menjadi angka ASCII gabungan
      let ascii = [];
      for (let i = 0; i < idSurat.length; i++) {
        ascii.push(idSurat.charCodeAt(i));
      }

      // Enkripsi tiap karakter
      let cipher = ascii.map(m => BigInt(m) ** BigInt(e) % BigInt(n)).join(" ");

      document.getElementById("cipher").value = cipher;

      // Generate QR Code
      let qrDiv = document.getElementById("qrcode");
      qrDiv.innerHTML = ""; // clear sebelumnya
      QRCode.toCanvas(cipher, { width: 300 }, function (err, canvas) {
        if (err) console.error(err);
        qrDiv.appendChild(canvas);
      });
    }
  </script>

</body>
</html>
