<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>RSA Encryption with QR Code</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jsbn/1.4.1/jsbn.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jsbn/1.4.1/jsbn2.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jsencrypt/3.0.0/jsencrypt.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
  <style>
    body { font-family: Arial; margin: 20px; }
    textarea { width: 100%; height: 60px; margin-bottom: 10px; }
    input, button { margin-bottom: 10px; padding: 5px; }
    #qrcode { margin-top: 20px; }
  </style>
</head>
<body>
  <h2>RSA Encryption + QR Code Generator</h2>

  <label>Plaintext (ID Dokumen):</label><br>
  <textarea id="plaintext">SERTIFIKAT/012/24052025/IGUSTIAYUSRI_BIDANGPENGMAS</textarea><br>

  <button onclick="generateKeys()">üîê Generate RSA Keys</button><br>
  <label>Public Key (n, e):</label>
  <textarea id="publicKey" readonly></textarea>
  <label>Private Key (d):</label>
  <textarea id="privateKey" readonly></textarea>

  <button onclick="encrypt()">üîí Encrypt</button><br>
  <label>Ciphertext:</label>
  <textarea id="ciphertext" readonly></textarea>

  <div id="qrcode"></div>
  <button onclick="downloadQR()">üíæ Download QR Code</button>

  <script>
    let rsa;

    function generateKeys() {
      rsa = new JSEncrypt({ default_key_size: 512 });
      rsa.getKey(); // Generate the keys

      document.getElementById("publicKey").value =
        "n: " + rsa.key.n.toString(16) + "\n" +
        "e: " + rsa.key.e.toString(16);

      document.getElementById("privateKey").value =
        "d: " + rsa.key.d.toString(16);
    }

    function encrypt() {
      const plaintext = document.getElementById("plaintext").value;
      if (!rsa) {
        alert("Please generate keys first.");
        return;
      }
      const ciphertext = rsa.encrypt(plaintext);
      document.getElementById("ciphertext").value = ciphertext;

      // Generate QR code
      const qrDiv = document.getElementById("qrcode");
      qrDiv.innerHTML = "";
      QRCode.toCanvas(ciphertext, { width: 200 }, function (err, canvas) {
        if (err) console.error(err);
        qrDiv.appendChild(canvas);
        canvas.id = "qrCanvas";
      });
    }

    function downloadQR() {
      const canvas = document.getElementById("qrCanvas");
      if (!canvas) {
        alert("Generate QR Code terlebih dahulu.");
        return;
      }
      const link = document.createElement("a");
      link.download = "qrcode.png";
      link.href = canvas.toDataURL();
      link.click();
    }
  </script>
</body>
</html>
