<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>RSA Digital Signature</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            max-width: 800px;
        }
        input, textarea {
            width: 100%;
            padding: 8px;
            margin: 4px 0 12px 0;
        }
        button {
            padding: 10px 20px;
            margin-bottom: 20px;
        }
        h2 {
            margin-top: 40px;
        }
    </style>
</head>
<body>

    <h1>RSA Digital Signature</h1>

    <h2>1. Generate Key</h2>
    <label for="p">Masukkan bilangan prima p:</label>
    <input type="number" id="p" placeholder="contoh: 61">

    <label for="q">Masukkan bilangan prima q:</label>
    <input type="number" id="q" placeholder="contoh: 53">

    <label for="e">Masukkan nilai e (relatif prima dengan φ(n)):</label>
    <input type="number" id="e" placeholder="contoh: 17">

    <button onclick="generateKeys()">Generate Keys</button>

    <label>Public Key:</label>
    <input type="text" id="publicKey" readonly>

    <label>Private Key:</label>
    <input type="text" id="privateKey" readonly>

    <h2>2. Tanda Tangan Pesan</h2>
    <label for="message">Pesan yang akan ditandatangani:</label>
    <input type="text" id="message" placeholder="contoh: Halo">

    <button onclick="signMessage()">Tandatangani Pesan</button>

    <label>Tanda Tangan:</label>
    <input type="text" id="signature" readonly>

    <h2>3. Verifikasi Tanda Tangan</h2>
    <label for="verifyMessage">Pesan asli:</label>
    <input type="text" id="verifyMessage" placeholder="contoh: Halo">

    <label for="verifySignature">Tanda tangan:</label>
    <input type="text" id="verifySignature" placeholder="salin tanda tangan di atas">

    <button onclick="verifySignature()">Verifikasi</button>

    <label>Hasil Verifikasi:</label>
    <input type="text" id="verificationResult" readonly>

    <script>
        // Fungsi untuk menghitung FPB
        function gcd(a, b) {
            return b === 0 ? a : gcd(b, a % b);
        }

        // Fungsi untuk menghitung invers modulo
        function modInverse(e, phi) {
            let [a, b, x0, x1] = [phi, e, 0, 1];
            while (b !== 0) {
                let q = Math.floor(a / b);
                [a, b] = [b, a % b];
                [x0, x1] = [x1, x0 - q * x1];
            }
            return x0 < 0 ? x0 + phi : x0;
        }

        // Fungsi untuk pemangkatan modulo
        function modPow(base, exp, mod) {
            let result = 1;
            base = base % mod;
            while (exp > 0) {
                if (exp % 2 === 1) result = (result * base) % mod;
                base = (base * base) % mod;
                exp = Math.floor(exp / 2);
            }
            return result;
        }

        // Variabel global
        let n, d, eGlobal;

        function generateKeys() {
            const p = parseInt(document.getElementById("p").value);
            const q = parseInt(document.getElementById("q").value);
            const e = parseInt(document.getElementById("e").value);

            if (!p || !q || !e) {
                alert("Isi semua input p, q, dan e!");
                return;
            }

            n = p * q;
            const phi = (p - 1) * (q - 1);

            if (gcd(e, phi) !== 1) {
                alert("e dan φ(n) tidak relatif prima. Pilih e lain.");
                return;
            }

            d = modInverse(e, phi);
            eGlobal = e;

            document.getElementById("publicKey").value = `(${e}, ${n})`;
            document.getElementById("privateKey").value = `(${d}, ${n})`;
        }

        function textToNumber(text) {
            return text.split('').map(char => char.charCodeAt(0)).join('');
        }

        function numberToText(numStr) {
            const codes = numStr.match(/.{1,2}/g);
            return codes.map(code => String.fromCharCode(parseInt(code))).join('');
        }

        function signMessage() {
            const message = document.getElementById("message").value;
            if (!message || !d || !n) {
                alert("Isi pesan dan pastikan kunci sudah digenerate!");
                return;
            }

            const mNumber = parseInt(textToNumber(message));
            const signature = modPow(mNumber, d, n);
            document.getElementById("signature").value = signature;
        }

        function verifySignature() {
            const message = document.getElementById("verifyMessage").value;
            const signature = parseInt(document.getElementById("verifySignature").value);

            if (!message || !signature || !eGlobal || !n) {
                alert("Isi semua bidang untuk verifikasi!");
                return;
            }

            const mExpected = parseInt(textToNumber(message));
            const mDecrypted = modPow(signature, eGlobal, n);

            const result = mExpected === mDecrypted ? "Valid" : "Tidak Valid";
            document.getElementById("verificationResult").value = result;
        }
    </script>

</body>
</html>
